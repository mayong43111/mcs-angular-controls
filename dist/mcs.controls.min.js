"use strict";var mcscontrols;!function(t){var o,e;(e=o||(o={}))[e.ESC=27]="ESC",e[e.TAB=9]="TAB",e[e.RETURN=13]="RETURN",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN";var n=function(){function n(t,e){var n=this;this.$q=t,this.$http=e,this.templateUrl="templates/mcs.autocomplete.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",bindingOptions:"=?",readonly:"=?mcsReadonly",optionsName:"@?mcsAutocomplete"},this.controller=["$scope",function(i){i.bindingValue&&angular.isArray(i.bindingValue)||(i.bindingValue=[]),i.bindingOptions&&angular.isArray(i.bindingOptions)||(i.bindingOptions=[]),i.that={suggestions:i.bindingOptions},i.options=i.optionsName?i.$parent.$eval(i.optionsName):{},i.$cache={},i.onKeyUp=function(t){if(!i.readonly){switch(t.which){case o.UP:case o.DOWN:case o.LEFT:case o.RIGHT:case o.ESC:return}var e=t.target.value;i.that&&e==i.that.currentValue||(i.that&&clearTimeout(i.that.onChangeTimeout),i.that={currentValue:e,show:!0},i.$cache[e]?i.that.suggestions=i.$cache[e]:i.that.onChangeTimeout=setTimeout(function(){n.onValueChange(i.that,i)},1e3))}},i.onFocus=function(){i.that&&(clearTimeout(i.that.onFocusTimeout),i.that.onFocusTimeout=setTimeout(function(){i.that.show=!0,i.$apply()},200))},i.onBlur=function(){i.that&&(clearTimeout(i.that.onBlurTimeout),i.that.onBlurTimeout=setTimeout(function(){i.that.show=!1,i.$apply()},200))},i.selected=function(t){i.bindingValue.push(t),i.tempNewValue="",i.that={},i.queryInputText&&(i.queryInputText.focus(),setTimeout(function(){n.onValueChange(i.that,i),i.$apply()},200))},i.remove=function(t){for(var e=0;e<i.bindingValue.length;e++){var n=i.bindingValue[e];if(n==t||n.id==t.id)return void i.bindingValue.splice(e,1)}}}],this.link=function(t,e,n,i,o){t.queryInputText=e.find(":text")}}return n.factory=function(){var t=function(t,e){return new n(t,e)};return t.$inject=["$q","$http"],t},n.prototype.onValueChange=function(e,n){if(clearTimeout(e.onChangeTimeout),e.loading=!0,e.currentValue&&n.options&&n.options.async&&n.options.async.url){var t=n.options.async.params||{};t=angular.extend(t,{searchTerm:e.currentValue}),this.$http.get(n.options.async.url,{params:t,data:{$autoLoading:!1}}).then(function(t){e.loading=!1,e.suggestions=t.data,n.$cache[e.currentValue]=t.data},function(){e.loading=!1})}else this.getSuggestionsLocal(e.currentValue,n.bindingOptions).then(function(t){e.loading=!1,e.suggestions=t,n.$cache[e.currentValue]=t},function(){e.loading=!1})},n.prototype.getSuggestionsLocal=function(t,e){var n=this.$q.defer(),i=[];if(t)for(var o=0;o<e.length;o++){var r=e[o];angular.isString(r)&&0<=r.indexOf(t)?i.push(r):r.name&&0<=r.name.indexOf(t)&&i.push(r)}else i=e||[];return n.resolve(i),n.promise},n}();angular.module("mcs.controls.autocomplete",["mcs.controls.templates"]).directive("mcsAutocomplete",n.factory())}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function t(){this.templateUrl="templates/mcs.checkbox.list.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",bindingOptions:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(o){var r=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(e.id==i.id)return!0}return!1},i=function(t){for(var e=0;e<o.internalOptions.length;e++){(n=o.internalOptions[e]).selected=r(t,n)}for(e=0;e<t.length;e++){var n=t[e];if(!r(o.internalOptions,n))if(o.readonly){var i=angular.copy(n);i.selected=!0,o.internalOptions.push(i)}else t.splice(e,1),e--}};o.$watch("bindingOptions",function(){!function(t){if(t.internalOptions=[],t.bindingOptions&&t.bindingOptions.constructor==Array&&0<t.bindingOptions.length)for(var e=0;e<t.bindingOptions.length;e++){var n=angular.copy(t.bindingOptions[e]);n.name=n.name||n.id,t.internalOptions.push(n)}i(t.bindingValue)}(o)},!0),o.$watch("bindingValue",function(t,e,n){t&&t.constructor==Array||(t=[]),i(t)},!0),o.toggle=function(t){if(t.selected)for(var e=0;e<o.bindingValue.length;e++){if(o.bindingValue[e].id==t.id)return void o.bindingValue.splice(e,1)}else o.bindingValue.push({id:t.id,name:t.name})}}]}return t.factory=function(){return function(){return new t}},t}();angular.module("mcs.controls.checkboxlist",["mcs.controls.templates"]).directive("mcsCheckboxList",e.factory())}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function t(){this.configuration={}}return t.prototype.getConfig=function(){return this.configuration},t.prototype.getResourceUri=function(t,e){if(0==t.indexOf("http"))return t;if(!e||!this.getAppSetting("resourceUri")||!this.getAppSetting("resourceUri")[e])return t;var n=this.getAppSetting("resourceUri")[e];return 0!=n.lastIndexOf("/")&&(n+="/"),0==t.indexOf("/")&&(t=t.slice(1,t.length)),n+t},t.prototype.getAppSetting=function(t){return this.getConfig()[t]},t.prototype.mergeConfigString=function(t){this.mergeConfig(angular.fromJson(t))},t.prototype.mergeConfig=function(t){return angular.extend(this.configuration,t)},t}(),n=function(){function t(){this.configurationBroker=new e}return t.prototype.initialize=function(t){this.configurationBroker.mergeConfig(t)},t.prototype.$get=function(){return this.configurationBroker},t.$inject=[],t}();angular.module("mcs.controls.configurationBroker",[]).provider("configurationBroker",n)}(mcscontrols||(mcscontrols={})),mcscontrols||(mcscontrols={}),angular.module("mcs.controls",["mcs.controls.templates","mcs.controls.input.text","mcs.controls.select","mcs.controls.input.checkbox","mcs.controls.checkboxlist","mcs.controls.radiolist","mcs.controls.toastr","mcs.controls.tree","mcs.controls.modal","mcs.controls.table.pagination","mcs.controls.input.date","mcs.controls.input.textarea","mcs.controls.input.number","mcs.controls.input.modal","mcs.controls.input.file","mcs.controls.configurationBroker","mcs.controls.loading","mcs.controls.input.ueditor","mcs.controls.autocomplete"]),function(t){var e=function(){function t(){this.templateUrl="templates/mcs.input.checkbox.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(t){void 0===t.bindingValue&&(t.bindingValue=!1),t.bindingValue.constructor==String&&(t.bindingValue="true"==t.bindingValue),t.bindingValue.constructor==Number&&(t.bindingValue=0<t.bindingValue),t.bindingValue&&t.bindingValue.constructor!=Boolean&&(t=Boolean(t.bindingValue))}]}return t.factory=function(){return function(){return new t}},t}();angular.module("mcs.controls.input.checkbox",["mcs.controls.templates"]).directive("mcsInputCheckbox",e.factory())}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function e(t){var r=this;this.$ocLazyLoad=t,this.templateUrl="templates/mcs.input.date.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",bindingOptions:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(n){n.options=angular.extend({},{format:"yyyy-mm-dd",readonlyFormat:"yyyy-MM-dd",autoclose:!0,todayBtn:"linked",todayHighlight:"true",minView:2,language:"zh-CN"},n.bindingOptions),n.$watch("bindingValue",function(t,e){n.datetimepicker&&n.datetimepicker.datetimepicker("update",t)})}],this.link=function(e,t,n,i,o){r.$ocLazyLoad.load(["datetimepicker"]).then(function(){e.datetimepicker=t.find(".form_datetime").datetimepicker(e.options).on("changeDate",function(t){e.$apply(function(){e.bindingValue=t.date})}),e.datetimepicker.datetimepicker("update",e.bindingValue)})}}return e.factory=function(){var t=function(t){return new e(t)};return t.$inject=["$ocLazyLoad"],t},e}();angular.module("mcs.controls.input.date",["oc.lazyLoad","mcs.controls.templates"]).directive("mcsInputDate",e.factory())}(mcscontrols||(mcscontrols={})),function(t){var p,e;(e=p||(p={}))[e.Unmodified=0]="Unmodified",e[e.Inserted=1]="Inserted",e[e.Updated=2]="Updated",e[e.Deleted=3]="Deleted",e[e.Uploaded=99]="Uploaded";var o=function(){function t(t,e,n,i,o,r){var a=this;this.$scope=t,this.$timeout=e,this.toastrService=n,this.configurationBroker=i,this.$ocLazyLoad=o,this.mcsUploader=r,this.setState=function(t){var e;if(t!==a.currentState)switch(a.currentState=t,a.currentState){case"pedding":case"ready":a.uploader.refresh();break;case"uploading":case"paused":break;case"confirm":if((e=a.uploader.getStats()).successNum&&!e.uploadFailNum)return void a.setState("finish");break;case"finish":(e=a.uploader.getStats()).successNum||(a.currentState="done")}},this.addFile=function(n){var i={id:n.id,name:n.name,status:null};a.$scope.$apply(function(t){t.files.push(i)});var o=function(t){var e;switch(t){case"exceed_size":e="文件大小超出";break;case"interrupt":e="上传暂停";break;default:e="上传失败，请重试"}a.$scope.$apply(function(t){i.isError=!0,i.errorMessage=e})};n.on("statuschange",function(t,e){"error"===t||"invalid"===t?(console.log(n.statusText),o(n.statusText)):"interrupt"===t?o("interrupt"):"complete"==t&&a.$scope.$apply(function(t){i.status=p.Uploaded})})},this.removeFile=function(t){for(var e=0;e<a.$scope.files.length;e++){if(a.$scope.files[e].id==t.id){a.$scope.files.splice(e,1);break}}t.status&&t.status!=p.Uploaded||a.uploader.removeFile(t.id),a.$scope.fileCount--,t.status||a.$scope.waitCount--;for(var n=0;n<a.$scope.data.value.length;n++){var i=a.$scope.data.value[n];if(i.id==t.id||i.clientID==t.id){i.status=p.Deleted;break}}},this.upload=function(){switch(a.currentState){case"ready":case"paused":a.uploader.upload();break;case"uploading":a.uploader.stop()}},this.initializeUploader=function(){var t=angular.extend({},{paste:document.body,disableGlobalDnd:!0,fileNumLimit:300},a.$scope.data.options.webuploader,{server:a.$scope.data.options.uploadUrl,swf:a.configurationBroker.getAppSetting("uploader.swfUrl"),pick:{id:a.$scope.container.find(".filePicker"),label:"点击选择附件"},dnd:a.$scope.container.find(".queueList")});a.$scope.fileNumLimit=t.fileNumLimit,a.uploader=WebUploader.create(t),a.uploader.addButton({id:a.$scope.container.find(".filePicker2"),label:"继续添加"}),a.uploader.onFileQueued=function(e){a.$scope.$apply(function(t){t.fileCount++,t.waitCount++,t.fileSize+=e.size}),a.addFile(e),a.setState("ready")},a.uploader.onFileDequeued=function(t){},a.uploader.onUploadSuccess=function(e,n){a.$scope.$apply(function(t){t.waitCount--,n[0].clientID=e.id,t.data.value.push(n[0])})},a.uploader.onUploadProgress=function(t,e){a.$scope.$apply(function(t){t.progress=1==e?null:100*(e=Number(e.toFixed(2)))+"%"})},a.uploader.onAll=function(t){switch(t){case"uploadFinished":a.setState("confirm");break;case"startUpload":a.setState("uploading");break;case"stopUpload":a.setState("paused")}},a.uploader.onError=function(t){a.toastrService.send("Eroor: "+t,"出错了 :(",3)},a.uploader.onUploadBeforeSend=a.mcsUploader.getInterceptor()},this.currentState="pedding";var s=t.closed;t.closed=function(){a.uploader&&a.uploader.destroy(),s()};var c=t.submitted;if(t.submitted=function(t){a.uploader&&a.uploader.destroy(),c(t)},t.files=[],t.data&&t.data.value)for(var l=0;l<t.data.value.length;l++){var u=t.data.value[l];if(u.status!=p.Deleted){var d={id:u.id,name:u.originalName,status:u.status};t.files.push(d)}}t.fileCount=t.files.length,t.waitCount=0,t.fileSize=0,t.removeFile=this.removeFile,t.upload=this.upload,o.load(["webuploader-load"]).then(function(){return a.initializeUploader()})}return t.$inject=["$scope","$timeout","toastrService","configurationBroker","$ocLazyLoad","mcsUploader"],t}(),n=function(){function t(){var i=this;this.defaultOptions={},this.templateUrl="templates/mcs.input.file.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",optionsName:"@mcsInputFile",readonly:"=?mcsReadonly"},this.controller=["$scope","modalService",function(e,t){var n=angular.extend({},i.defaultOptions,e.$eval(e.optionsName));e.bindingValue&&e.bindingValue.constructor===Array||(e.bindingValue=[]),e.open=function(){t.open({title:"附件上传...",templateUrl:"templates/mcs.input.file.modal.html",data:{options:n,value:e.bindingValue},controller:o}).then(function(t){e.bindingValue=t.value})},e.remove=function(t){t.status=p.Deleted}}]}return t.factory=function(){return function(){return new t}},t}(),i=function(t){var e=this;this.interceptor=t,this.getInterceptor=function(){return e.interceptor}},r=function(){function t(){var t=this;this.$get=[function(){return new i(t.interceptor)}]}return t.$inject=[],t}(),a=angular.module("mcs.controls.input.file",["oc.lazyLoad","mcs.controls.templates","mcs.controls.configurationBroker"]);a.directive("mcsInputFile",n.factory()),a.provider("mcsUploader",r)}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function t(t){this.loadPaginationData=function(t,e){return{pageIndex:t.pageIndex,pageSize:t.pageSize,totalCount:500,data:[{id:t.pageIndex+"001",text:"的第一孩子"},{id:t.pageIndex+"002",text:"的第二孩子"},{id:t.pageIndex+"003",text:"的第三孩子"}]}},t.gridOptions={adapter:{loadPaginationData:this.loadPaginationData}}}return t.$inject=["$scope"],t}(),n=function(){function t(t){this.loadChildren=function(t){return[{id:t+"001",name:t+"的第一孩子"},{id:t+"002",name:t+"的第二孩子"},{id:t+"003",name:t+"的第三孩子"}]},t.treeOptions={adapter:{loadChildren:this.loadChildren},data:{id:"001",name:"第一级节点",loaded:!0,open:!0,children:[{id:"001001",name:"第二级节点01"},{id:"001002",name:"第二级节点02",loaded:!0},{id:"001003",name:"第二级节点03",loaded:!0,children:[]},{id:"001004",name:"第二级节点04",loaded:!0,open:!0,children:[{id:"001004001",name:"第三级节点01"}]}]}}}return t.$inject=["$scope"],t}(),i=function(){function t(){var r=this;this.modeDefine={table:{templateUrl:"templates/mcs.input.modal.table.html",controller:e},tree:{templateUrl:"templates/mcs.input.modal.tree.html",controller:n},custom:{templateUrl:null,controller:null}},this.defaultOptions={mode:"custom"},this.templateUrl="templates/mcs.input.modal.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",optionsName:"@mcsInputModal",readonly:"=?mcsReadonly"},this.controller=["$scope","$templateCache","modalService",function(e,t,n){e.bindingValue&&e.bindingValue.constructor==Array||(e.bindingValue=[]);var i=angular.extend({},r.defaultOptions,e.$eval(e.optionsName)),o=r.modeDefine[i.mode];i.templateUrl=i.templateUrl||o.templateUrl,i.controller=i.controller||o.controller,e.open=function(){n.open({title:"请选择...",templateUrl:i.templateUrl,data:{options:i,value:e.bindingValue},controller:i.controller}).then(function(t){e.bindingValue=t})}}]}return t.factory=function(){return function(){return new t}},t}();angular.module("mcs.controls.input.modal",["mcs.controls.templates"]).directive("mcsInputModal",i.factory())}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function t(){var n=this;this.templateUrl="templates/mcs.input.number.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",unit:"=",precision:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(e){e.setValue=function(t){(t=n.removeComma(t))&&(t=Number(t),e.precision&&0<Number(e.precision)&&(t=t.toFixed(Number(e.precision)))),e.bindingValue=t,e.bindingText=n.addComma(e.bindingValue)},e.keyup=function(){e.bindingText=e.bindingText.replace(/[^\d+-\.]/g,"")},e.$watch("bindingValue",function(t,e,n){n.setValue(t)})}],this.link=function(t,e,n,i,o){},this.addComma=function(t){if(0===t)return 0;var e=t+"";e=e.replace(new RegExp(",","g"),"");var n="";if(/^([-+]).*$/.test(e)&&(n=e.replace(/^([-+]).*$/,"$1"),e=e.replace(/^([-+])(.*)$/,"$2")),/^[0-9]+(\.[0-9]+)?$/.test(e)){e=e.replace(new RegExp("^[0]+","g"),""),/^\./.test(e)&&(e="0"+e);for(var i=e.replace(/^[0-9]+(\.[0-9]+)?$/,"$1"),o=e.replace(/^([0-9]+)(\.[0-9]+)?$/,"$1"),r=/(\d+)(\d{3})/;r.test(o);)o=o.replace(r,"$1,$2");return n+o+i}return t},this.removeComma=function(t){var e=t+"";return e=e.replace(new RegExp(",","g"),""),/^[-+]?[0-9]+(\.[0-9]+)?$/.test(e)?e:t}}return t.factory=function(){return function(){return new t}},t}();angular.module("mcs.controls.input.number",["mcs.controls.templates"]).directive("mcsInputNumber",e.factory())}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function t(){this.templateUrl="templates/mcs.input.text.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(t){}]}return t.factory=function(){return function(){return new t}},t}();angular.module("mcs.controls.input.text",["mcs.controls.templates"]).directive("mcsInputText",e.factory())}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function t(){this.templateUrl="templates/mcs.input.textarea.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(t){}],this.link=function(t,n,e,i,o){var r,a,s=function(){var t=r.scrollHeight+2,e=t<a?a:t;r.style.height=e+"px"};t.$watch("readonly",function(t,e){t||((r=n.find("textarea")[0]).style["overflow-y"]="hidden",r.style["word-break"]="break-all",r.style.resize="vertical",r.scrollTop=0,a=r.scrollHeight,s())}),t.$watch("bindingValue",function(t,e){r&&s()})}}return t.factory=function(){return function(){return new t}},t}();angular.module("mcs.controls.input.textarea",["mcs.controls.templates"]).directive("mcsInputTextarea",e.factory())}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function e(t){var i=this;this.$ocLazyLoad=t,this.templateUrl="templates/mcs.input.ueditor.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",readonly:"=?mcsReadonly"},this.controller=["$scope","$sce",function(n,i){n.$watch("readonly",function(t,e){n.ueditor&&(t?n.ueditor.setHide():n.ueditor.setShow())}),n.$watch("bindingValue",function(t,e){n.bindingHtml=i.trustAsHtml(t),n.ueditor&&!n.$innerUpdateValue&&n.ueditor.setContent(n.bindingValue),n.$innerUpdateValue=!1})}],this.link=function(o,r,t,e,n){i.$ocLazyLoad.load(["ueditor"]).then(function(){var t=r.find(".container"),e="umeditor-"+Math.floor(100*Math.random()).toString()+(new Date).getTime().toString();t.attr("id",e);var n=UM.getEditor(e);n.ready(function(){(o.ueditor=n).setContent(o.bindingValue),o.$innerUpdateValue=!1,o.readonly?o.ueditor.setHide():o.ueditor.setShow()});var i=function(){var t=n.getContent();o.bindingValue!=t&&(o.bindingValue=t,o.$innerUpdateValue=!0,o.$apply())};n.addListener("contentChange",i),n.addListener("blur",i)})}}return e.factory=function(){var t=function(t){return new e(t)};return t.$inject=["$ocLazyLoad"],t},e}();angular.module("mcs.controls.input.ueditor",["oc.lazyLoad","mcs.controls.templates"]).directive("mcsInputUeditor",e.factory())}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function t(t,e){this.$rootScope=t,this.$templateCache=e,this.initLoading(),this.count=0}return t.prototype.initLoading=function(){this.template=angular.element(this.$templateCache.get("templates/mcs.loading.html")),angular.element(document).find("body").append(this.template),this.template.addClass("hidden")},t.prototype.start=function(){this.count++,this.template&&this.template.removeClass("hidden")},t.prototype.stop=function(){this.count--,this.template&&this.count<=0&&this.template.addClass("hidden")},t.$inject=["$rootScope","$templateCache"],t}(),n=angular.module("mcs.controls.loading",["mcs.controls.templates"]);n.service("loadingService",e),n.run(["loadingService","$rootScope",function(e,t){t.$on("HTTP_REQUEST_START",function(t){e.start()}),t.$on("HTTP_REQUEST_STOP",function(t){e.stop()})}]);var i=function(){function n(t,e){var n=this;this.$q=t,this.$rootScope=e,this.request=function(t){return t&&t.data&&t.data.$autoLoading&&n.$rootScope.$broadcast("HTTP_REQUEST_START"),t},this.requestError=function(t){return n.$rootScope.$broadcast("HTTP_REQUEST_STOP"),n.$q.reject(t)},this.response=function(t){return t.config&&t.config.data&&t.config.data.$autoLoading&&n.$rootScope.$broadcast("HTTP_REQUEST_STOP"),t},this.responseError=function(t){return n.$rootScope.$broadcast("HTTP_REQUEST_STOP"),n.$q.reject(t)}}return n.factory=function(){var t=function(t,e){return new n(t,e)};return t.$inject=["$q","$rootScope"],t},n}();n.config(["$httpProvider",function(t){t.interceptors.push(i.factory())}])}(mcscontrols||(mcscontrols={})),function(t){var i,e,n,o;(e=i||(i={}))[e.lg=0]="lg",e[e.sm=1]="sm",(o=n||(n={}))[o.Info=0]="Info",o[o.Success=1]="Success",o[o.Warning=2]="Warning",o[o.Error=3]="Error";var r=function(){function t(t,e,n,i,o,r,a){this.$rootScope=t,this.$compile=e,this.$controller=n,this.$http=i,this.$templateCache=o,this.$q=r,this.toastrService=a}return t.prototype.open=function(o){var r=this,a=this.$q.defer(),s=angular.element(this.$templateCache.get("templates/mcs.modal.html"));return this.loadModalBody(o).then(function(t){s.find(".modal-body").replaceWith(t);var e=function(){i.remove(),n.$destroy()},n=r.$rootScope.$new();n.container=t,n.data=angular.copy(o.data),n.title=o.title||"Info",n.sizeClassName=r.getSizeClassName(o.size),n.className=o.className||"",n.closed=function(){e(),a.notify()},n.submitted=function(t){e(),a.resolve(t)},o.controller&&r.$controller(o.controller,{$scope:n});var i=r.$compile(s)(n);angular.element(document).find("body").append(i)}),a.promise},t.prototype.alert=function(t,e,n){return this.open({title:e||this.getDefautTitle(n),data:t,controller:["$scope",function(t){t.closed=t.submitted}],size:i.sm,className:this.getClassName(n),template:this.$templateCache.get("templates/mcs.modal.alert.html")})},t.prototype.confirm=function(t,e,n){return this.open({title:e||this.getDefautTitle(n),data:t,size:i.sm,className:this.getClassName(n),template:this.$templateCache.get("templates/mcs.modal.confirm.html")})},t.prototype.loadModalBody=function(t){var e=this,n=this.$q.defer();if(t.template)n.resolve(angular.element(t.template));else{if(!t.templateUrl)throw"must need template or templateUrl";var i=this.$templateCache.get(t.templateUrl);i?n.resolve(angular.element(i)):this.$http.get(t.templateUrl).then(function(t){var e=t.data;n.resolve(angular.element(e))},function(t){e.toastrService.send("HTTP获取页面","出错了 :(",3)})}return n.promise},t.prototype.getDefautTitle=function(t){switch(t){case n.Success:return"Success";case n.Warning:return"Warning";case n.Error:return"Error";default:return"Info"}},t.prototype.getSizeClassName=function(t){return t==i.sm?"sm":"lg"},t.prototype.getClassName=function(t){switch(t){case n.Success:return"success";case n.Warning:return"warning";case n.Error:return"error";default:return"info"}},t.$inject=["$rootScope","$compile","$controller","$http","$templateCache","$q","toastrService"],t}();angular.module("mcs.controls.modal",["mcs.controls.templates"]).service("modalService",r)}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function t(){this.templateUrl="templates/mcs.radio.list.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",bindingText:"=?",bindingOptions:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(o){var r=function(t){for(var e=!1,n=0;n<o.internalOptions.length;n++){var i=o.internalOptions[n];i.selected=t==i.id,i.selected&&(e=!0)}e||(o.readonly?void 0!==o.bindingValue&&o.internalOptions.push({id:o.bindingValue,name:o.bindingText||o.bindingValue}):o.bindingValue=void 0)};o.$watch("bindingOptions",function(){!function(t){if(t.internalOptions=[],t.bindingOptions&&t.bindingOptions.constructor==Array&&0<t.bindingOptions.length)for(var e=0;e<t.bindingOptions.length;e++){var n=angular.copy(t.bindingOptions[e]);n.name=n.name||n.id,t.internalOptions.push(n)}r(t.bindingValue)}(o)},!0),o.$watch("bindingValue",function(t,e,n){if(n.bindingText=void 0,t&&n.internalOptions&&0<n.internalOptions.length)for(var i=0;i<n.internalOptions.length;i++){var o=n.internalOptions[i];if(o.id==n.bindingValue){n.bindingText=o.name;break}}r(t)},!0)}]}return t.factory=function(){return function(){return new t}},t}();angular.module("mcs.controls.radiolist",["mcs.controls.templates"]).directive("mcsRadioList",e.factory())}(mcscontrols||(mcscontrols={})),function(t){var e=function(){function t(){this.templateUrl="templates/mcs.select.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",bindingText:"=?",bindingOptions:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(t){var e=function(t){if(t.bindingValue=t.bindingValue||"",!t.readonly)if(t.internalOptions=[],t.internalOptions.push({id:"",name:"请选择..."}),t.bindingOptions&&t.bindingOptions.constructor==Array&&0<t.bindingOptions.length){for(var e=!1,n=0;n<t.bindingOptions.length;n++){var i=t.bindingOptions[n];i&&(t.internalOptions.push(angular.copy(i)),i.id==t.bindingValue&&(e=!0))}e||(t.bindingValue="")}else t.bindingValue&&t.internalOptions.push({id:t.bindingValue,name:t.bindingText||t.bindingValue})};t.$watch("readonly",function(){e(t)},!0),t.$watch("bindingOptions",function(){e(t)},!0),t.$watch("bindingValue",function(t,e,n){if(n.bindingText=void 0,t&&n.internalOptions&&0<n.internalOptions.length)for(var i=0;i<n.internalOptions.length;i++){var o=n.internalOptions[i];if(o.id==n.bindingValue){n.bindingText=o.name;break}}})}]}return t.factory=function(){return function(){return new t}},t}();angular.module("mcs.controls.select",["mcs.controls.templates"]).directive("mcsSelect",e.factory())}(mcscontrols||(mcscontrols={})),function(t){var n=function(){function t(i,t,e,n){var o=this;if(this.$scope=i,this.$q=t,this.$http=e,this.configurationBroker=n,this.currentOptions=i.$parent.$eval(i.optionsName),!this.currentOptions)throw"Must have options";i.selectedAll=!1,this.currentPagination={pageIndex:1,pageSize:this.currentOptions.pageSize||20,totalCount:-1,top:-1},i.selected=function(t){if(t.$selected=!t.$selected,t.$selected)i.bindingValue.push({id:t.id,name:t.name,data:t});else for(var e=0;e<i.bindingValue.length;e++){var n=i.bindingValue[e];if(t.id==n.id){i.bindingValue.splice(e,1);break}}i.updateSelectedAll()},i.updateSelectedAll=function(){for(var t=0<i.data.length,e=0;e<i.data.length;e++){if(!i.data[e].$selected){t=!1;break}}i.selectedAll=t},i.allSelected=function(){for(var t=i.selectedAll,e=0;e<i.data.length;e++){var n=i.data[e];t==Boolean(n.$selected)&&i.selected(n)}},i.changePaginate=function(t){t&&t.pageIndex!=o.currentPagination.pageIndex&&o.refresh(t)},i.$watch("bindingValue",function(t,e,n){n.bindingValue=n.bindingValue||[],n.bindingValue.constructor!=Array&&(n.bindingValue=[]),o.refreshSelected(n)}),this.loadPaginationData(this.currentPagination,this.currentOptions).then(function(t){o.initializeScope(t,i)}),this.currentOptions.callback&&this.currentOptions.callback.onInitiated&&this.currentOptions.callback.onInitiated(this)}return t.prototype.refresh=function(t){var e=this;t=t||this.currentPagination,this.loadPaginationData(t,this.currentOptions).then(function(t){e.initializeScope(t,e.$scope)})},t.prototype.search=function(t){var e=this,n={pageIndex:1,pageSize:this.currentOptions.pageSize||20,totalCount:-1,top:-1};t&&(this.currentOptions.async=this.currentOptions.async||{},this.currentOptions.async.params=t),this.loadPaginationData(n,this.currentOptions).then(function(t){e.initializeScope(t,e.$scope)})},t.prototype.initializeScope=function(t,e){this.calculateCurrentPaginate(e,t),e.data=t.pagedData,this.refreshSelected(e)},t.prototype.refreshSelected=function(t){if(t.data){for(var e=0;e<t.data.length;e++){var n=t.data[e];if(t.bindingValue)for(var i=0;i<t.bindingValue.length;i++){var o=t.bindingValue[i];if(n.id==o.id){n.$selected=!0;break}}else n.$selected=!1}t.updateSelectedAll()}},t.prototype.loadPaginationData=function(t,e){var n=this.$q.defer(),i={pageParams:t};if(e.async&&e.async.params&&(i.condition=e.async.params),e.async&&e.async.orderBy&&(i.orderBy=e.async.orderBy),e.adapter&&e.adapter.loadPaginationData){var o=e.adapter.loadPaginationData(i);this.isIPromise(o)?o.then(function(t){n.resolve(t)}):n.resolve(o)}else if(e.async&&e.async.url){var r=this.configurationBroker.getResourceUri(e.async.url,e.async.resourceUri);this.$http.post(r,i).then(function(t){n.resolve(t.data)})}return n.promise},t.prototype.isIPromise=function(t){return t&&void 0!==t.then},t.prototype.calculateCurrentPaginate=function(t,e){var n=this.currentPagination={pageIndex:e.pageIndex,pageSize:e.pageSize,totalCount:e.totalCount,top:-1};if(t.currentPaginate=n,t.paginates=[],t.previousPaginate=null,t.nextPaginate=null,t.firstPaginate=null,t.lastestPaginate=null,t.isShowLastestMore=!1,t.isShowFirstMore=!1,n.totalCount&&n.pageSize){var i=Math.ceil(n.totalCount/n.pageSize);if(t.totalPageCount=i,n.pageIndex<i){var o={pageIndex:n.pageIndex+1,pageSize:n.pageSize,totalCount:n.totalCount,top:-1};t.nextPaginate=o}if(1<n.pageIndex){var r={pageIndex:n.pageIndex-1,pageSize:n.pageSize,totalCount:n.totalCount,top:-1};t.previousPaginate=r}var a=n.pageIndex-2;a<1&&(a=1);var s=a+4;if(1<a){var c={pageIndex:1,pageSize:n.pageSize,totalCount:n.totalCount,top:-1};t.firstPaginate=c}if(t.isShowFirstMore=2<a,s<=i){var l={pageIndex:i,pageSize:n.pageSize,totalCount:n.totalCount,top:-1};t.lastestPaginate=l}for(s<i&&(t.isShowLastestMore=!0);a<s&&a<=i;a++){var u={pageIndex:a,pageSize:n.pageSize,totalCount:n.totalCount,top:-1};t.paginates.push(u)}}},t.$inject=["$scope","$q","$http","configurationBroker"],t}(),e=function(){function i(t,e){var i=this;this.$templateCache=t,this.$compile=e,this.restrict="A",this.replace=!0,this.scope={bindingValue:"=?",optionsName:"@mcsTablePagination",readonly:"=?mcsReadonly"},this.controller=n,this.template=function(t,e){var n=i.initializTableInfo(t);return i.initializHead(n),i.initializeBody(n),i.initializPagination(n),i.initializAllCheckbox(n),n.container[0].outerHTML}}return i.factory=function(){var t=function(t,e,n){return new i(t,e)};return t.$inject=["$templateCache","$compile"],t},i.prototype.initializTableInfo=function(t){var e=angular.element("<div></div>"),n=t.clone();n.removeAttr("mcs-table-pagination"),e.append(n);var i=n.find("tbody");if(1!=i.length)throw"Tables can only have one tbody;";var o=i.find("tr");if(0==o.length)throw"tbody must have tr;";for(var r=0,a=0;a<o[0].children.length;a++){var s=o[0].children[a];r+=Number(s.getAttribute("colspan"))||1}return{container:e,table:n,thead:n.find("thead"),tBody:i,tfoot:n.find("tfoot"),columnsCount:r}},i.prototype.initializAllCheckbox=function(t){var e=this.renderCheckbox(t.thead),n=this.renderCheckbox(t.tBody);this.renderCheckbox(t.tfoot);this.bindingItemCheckbox(n),this.bindingAllCheckbox(e)},i.prototype.bindingItemCheckbox=function(t){t&&(t.attr("ng-click","selected(item, $event)"),t.attr("ng-checked","item.$selected"))},i.prototype.bindingAllCheckbox=function(t){t&&(t.attr("ng-click","allSelected()"),t.attr("ng-checked","selectedAll"))},i.prototype.renderCheckbox=function(t){var e=t.find("tr");if(0<e.length){var n=angular.element('<th ng-hide="readonly"></th>'),i=angular.element('<input type="checkbox" ng-disabled="readonly" />');return n.append(i),n.attr("rowspan",e.length),angular.element(e[0]).prepend(n),i}},i.prototype.initializHead=function(t){},i.prototype.initializeBody=function(t){var e=t.tBody.find("tr");1==e.length?e.attr("ng-repeat","item in data track by $index"):(e[0].setAttribute("ng-repeat-start","item in data track by $index"),e[e.length-1].setAttribute("ng-repeat-end",""))},i.prototype.initializPagination=function(t){var e=this.$templateCache.get("templates/mcs.table.pagination.html");t.container.append(e)},i}();angular.module("mcs.controls.table.pagination",["mcs.controls.templates","mcs.controls.configurationBroker"]).directive("mcsTablePagination",e.factory())}(mcscontrols||(mcscontrols={})),function(t){var a,e;(e=a||(a={}))[e.Info=0]="Info",e[e.Success=1]="Success",e[e.Warning=2]="Warning",e[e.Error=3]="Error";var n=function(){function t(t,e,n){this.interval=10;var i=t.get("templates/mcs.toast.html");if(!i)throw"must need templates/mcs.toast.html";this.toastrScope=n.$new(),this.toastrScope.messages=[],this.toastrScope.setRemainingTimeZero=function(t){t.remainingTime=0};var o=e(angular.element(i))(this.toastrScope);angular.element(document).find("body").append(o)}return t.prototype.send=function(t,e,n,i){var o=this;if(t){n=n||a.Info,i=i||5e3;var r={title:e||this.getDefautTitle(n),content:t,remaining:this.getRemaining(i,i),remainingTime:i,timeOut:i,className:this.getClassName(n)};this.toastrScope.messages.push(r),this.intervalID||(this.intervalID=window.setInterval(function(){return o.innerTimerHandler()},this.interval))}},t.prototype.innerTimerHandler=function(){for(var t=this.toastrScope.messages,e=0;e<t.length;e++){var n=t[e];if(n.remainingTime-=this.interval,n.remaining=this.getRemaining(n.remainingTime,n.timeOut),n.remainingTime<=0)return t.splice(e,1),this.innerTimerHandler()}0==t.length&&(window.clearInterval(this.intervalID),this.intervalID=void 0),this.toastrScope.$apply()},t.prototype.getRemaining=function(t,e){return t<0?"0":t/e*100+"%"},t.prototype.getDefautTitle=function(t){switch(t){case a.Success:return"Success";case a.Warning:return"Warning";case a.Error:return"Error";default:return"Info"}},t.prototype.getClassName=function(t){switch(t){case a.Success:return"success";case a.Warning:return"warning";case a.Error:return"error";default:return"info"}},t.$inject=["$templateCache","$compile","$rootScope"],t}(),i=angular.module("mcs.controls.toastr",["mcs.controls.templates"]);i.service("toastrService",n),i.run(["toastrService","$rootScope",function(i,t){t.$on("HTTP_REQUEST_ERROR",function(t,e){if(e&&e.status)if(401<=e.status&&e.status<402)i.send(e.statusText||"权限不足","出错了 :)",3);else if(500<=e.status){var n=e.statusText||"HTTP请求失败";e.data&&e.data.description&&(n=e.data.description),i.send(n,"出错了 :)",3)}else i.send("HTTP请求失败","出错了 :)",2);else i.send("HTTP请求失败","出错了 :)",2)})}]);var o=function(){function n(t,e){var n=this;this.$q=t,this.$rootScope=e,this.requestError=function(t){return n.$rootScope.$broadcast("HTTP_REQUEST_ERROR",t),n.$q.reject(t)},this.responseError=function(t){return n.$rootScope.$broadcast("HTTP_REQUEST_ERROR",t),n.$q.reject(t)}}return n.factory=function(){var t=function(t,e){return new n(t,e)};return t.$inject=["$q","$rootScope"],t},n}();i.config(["$httpProvider",function(t){t.interceptors.push(o.factory())}])}(mcscontrols||(mcscontrols={})),function(t){var o,e;(e=o||(o={}))[e.folder=0]="folder",e[e.file=1]="file",e[e.user=2]="user";var n=function(){function t(e,t,n,i,o,r,a){var s=this;if(this.$scope=e,this.$q=t,this.$templateCache=n,this.$compile=i,this.$controller=o,this.$http=r,this.toastrService=a,!e.optionsName)throw"must need options.";var c=e.$parent.$eval(e.optionsName);if(!c)throw"must need options.";this._options=angular.copy(c),this.initializeOptions(this._options),this.loadRootNode().then(function(t){s.renderTreeNode(e.rootContainer,e,t)})}return t.prototype.renderTreeNode=function(t,e,n){var i=angular.element(this.$templateCache.get("templates/mcs.tree.node.html")),o=e.$new();o.rootController=this,o.item=n,o.nodeContainer=i.find(".node-container"),this.$controller(a,{$scope:o});var r=this.$compile(i)(o);t.append(r)},t.prototype.focusNode=function(t){this._focusNode&&(this._focusNode.focus=!1),t.focus=!0,this._focusNode=t,this.selected(t),this._options.callback&&this._options.callback.onClick&&this._options.callback.onClick(t.source,{})},t.prototype.loadRootNode=function(){var n=this,i=this.$q.defer();if(this.$scope.data)i.resolve(this.convertViewModel(this._options.data,0));else if(this._options.data){var t=angular.copy(this._options.data);t.open=null!=this._options.data.children,this.$scope.data=this.convertViewModel(t,0),i.resolve(this.$scope.data)}else if(this._options.async&&this._options.async.url){var e=null;this._options.async&&this._options.async.params&&(e=this._options.async.params),this.$http.get(this._options.async.url+"/Root",{params:e}).then(function(t){var e=t.data;e?(n.$scope.data=n.convertViewModel(e,0),i.resolve(n.$scope.data)):n.toastrService.send("HTTP无法找到节点","出错了 :(",2)},function(t){n.toastrService.send("HTTP获取根节点失败","出错了 :(",3)})}return i.promise},t.prototype.loadChildrenTreeNode=function(n){var i=this,o=this.$q.defer(),t=this._options;if(n.children)o.resolve(n.children);else if(t.adapter&&t.adapter.loadChildren){var e=null;t.async&&t.async.params&&(e=t.async.params);var r=t.adapter.loadChildren(n.source.id,e);if(this.isIPromise(r))r.then(function(t){t=t||[];var e=i.convertViewModels(t,n.level);n.children=e,n.loaded=!0,o.resolve(n.children)});else{var a=this.convertViewModels(r,n.level);n.children=a,n.loaded=!0,o.resolve(n.children)}}return o.promise},t.prototype.selected=function(t){if(!this.$scope.bindingValue||this.$scope.bindingValue.id!=t.source.id){var e=angular.copy(t.source);e.children=void 0,this.$scope.bindingValue=e}},t.prototype.initializeOptions=function(t){t.edit?(t.edit.enable=void 0!==t.edit.enable&&t.edit.enable,t.edit.allowAdd=void 0===t.edit.allowAdd?t.edit.enable:t.edit.allowAdd,t.edit.allowDel=void 0===t.edit.allowDel?t.edit.enable:t.edit.allowDel,t.edit.allowEdit=void 0===t.edit.allowEdit?t.edit.enable:t.edit.allowEdit):t.edit={enable:!1,allowAdd:!1,allowDel:!1,allowEdit:!1}},t.prototype.isIPromise=function(t){return t&&void 0!==t.then},t.prototype.convertViewModels=function(t,e){for(var n=[],i=0;i<t.length;i++){var o=t[i],r=this.convertViewModel(o,e);r&&n.push(r)}return n},t.prototype.convertViewModel=function(t,e){if(t){var n=t,i={level:++e,open:n.open||!1,loaded:!1,type:n.type||o.folder,source:t,focus:!1,allowAdd:void 0===t.allowAdd?this._options.edit.allowAdd:t.allowAdd,allowDel:void 0===t.allowDel?this._options.edit.allowDel:t.allowDel,allowEdit:void 0===t.allowEdit?this._options.edit.allowEdit:t.allowEdit};return n.children&&n.children.constructor==Array&&(i.loaded=!0,i.children=this.convertViewModels(n.children,e)),i}},t.$inject=["$scope","$q","$templateCache","$compile","$controller","$http","toastrService"],t}(),a=function(){function t(t){var e=this;(this.$scope=t).expand=function(){t.item.open=!t.item.open,t.item.open&&!t.item.loaded&&t.item.type==o.folder&&e.internalRenderChildren(t)},t.focusNode=function(){t.rootController.focusNode(t.item)},t.item.open&&t.item.type==o.folder&&this.internalRenderChildren(t)}return t.prototype.internalRenderChildren=function(i){i.rootController.loadChildrenTreeNode(i.item).then(function(t){i.nodeContainer.html("");for(var e=0;e<t.length;e++){var n=t[e];i.rootController.renderTreeNode(i.nodeContainer,i,n)}})},t.$inject=["$scope"],t}(),i=function(){function t(){this.templateUrl="templates/mcs.tree.html",this.restrict="A",this.scope={optionsName:"@mcsTree",bindingValue:"=",readonly:"=?mcsReadonly"},this.controller=n,this.link=function(t,e,n,i,o){t.rootContainer=e.find(".ztree")}}return t.factory=function(){return function(){return new t}},t}();angular.module("mcs.controls.tree",["mcs.controls.templates"]).directive("mcsTree",i.factory())}(mcscontrols||(mcscontrols={}));
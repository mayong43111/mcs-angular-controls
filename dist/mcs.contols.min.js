"use strict";var $CheckboxListControlDirective=function(){function e(){this.templateUrl="templates/mcs.checkbox.list.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",bindingOptions:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(o){var r=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(t.value==i.value)return!0}return!1},i=function(e){for(var t=0;t<o.internalOptions.length;t++){(n=o.internalOptions[t]).selected=r(e,n)}for(t=0;t<e.length;t++){var n=e[t];if(!r(o.internalOptions,n))if(o.readonly){var i=angular.copy(n);i.selected=!0,o.internalOptions.push(i)}else e.splice(t,1),t--}};o.$watch("bindingOptions",function(){!function(e){if(e.internalOptions=[],e.bindingOptions&&e.bindingOptions.constructor==Array&&0<e.bindingOptions.length)for(var t=0;t<e.bindingOptions.length;t++){var n=angular.copy(e.bindingOptions[t]);n.text=n.text||n.value,e.internalOptions.push(n)}i(e.bindingValue)}(o)},!0),o.$watch("bindingValue",function(e,t,n){e&&e.constructor==Array||(e=[]),i(e)},!0),o.toggle=function(e){if(e.selected)for(var t=0;t<o.bindingValue.length;t++){if(o.bindingValue[t].value==e.value)return void o.bindingValue.splice(t,1)}else o.bindingValue.push({value:e.value,text:e.text})}}]}return e.factory=function(){return function(){return new e}},e}();(module=angular.module("mcs.contols.checkboxlist",["mcs.controls.templates"])).directive("mcsCheckboxList",$CheckboxListControlDirective.factory());var module=angular.module("mcs.contols",["mcs.controls.templates","mcs.contols.input.text","mcs.contols.select","mcs.contols.input.checkbox","mcs.contols.checkboxlist","mcs.contols.radiolist","mcs.contols.toastr","mcs.contols.tree"]),$CheckboxControlDirective=function(){function e(){this.templateUrl="templates/mcs.input.checkbox.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(e){void 0===e.bindingValue&&(e.bindingValue=!1),e.bindingValue.constructor==String&&(e.bindingValue="true"==e.bindingValue),e.bindingValue.constructor==Number&&(e.bindingValue=0<e.bindingValue),e.bindingValue&&e.bindingValue.constructor!=Boolean&&(e=Boolean(e.bindingValue))}]}return e.factory=function(){return function(){return new e}},e}();(module=angular.module("mcs.contols.input.checkbox",["mcs.controls.templates"])).directive("mcsInputCheckbox",$CheckboxControlDirective.factory());var $TextControlDirective=function(){function e(){this.templateUrl="templates/mcs.input.text.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(e){}]}return e.factory=function(){return function(){return new e}},e}();(module=angular.module("mcs.contols.input.text",["mcs.controls.templates"])).directive("mcsInputText",$TextControlDirective.factory());var $RadiokboxListControlDirective=function(){function e(){this.templateUrl="templates/mcs.radio.list.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",bindingText:"=?",bindingOptions:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(o){var r=function(e){for(var t=!1,n=0;n<o.internalOptions.length;n++){var i=o.internalOptions[n];i.selected=e==i.value,i.selected&&(t=!0)}t||(o.readonly?void 0!==o.bindingValue&&o.internalOptions.push({value:o.bindingValue,text:o.bindingText||o.bindingValue}):o.bindingValue=void 0)};o.$watch("bindingOptions",function(){!function(e){if(e.internalOptions=[],e.bindingOptions&&e.bindingOptions.constructor==Array&&0<e.bindingOptions.length)for(var t=0;t<e.bindingOptions.length;t++){var n=angular.copy(e.bindingOptions[t]);n.text=n.text||n.value,e.internalOptions.push(n)}r(e.bindingValue)}(o)},!0),o.$watch("bindingValue",function(e,t,n){if(n.bindingText=void 0,e&&n.internalOptions&&0<n.internalOptions.length)for(var i=0;i<n.internalOptions.length;i++){var o=n.internalOptions[i];if(o.value==n.bindingValue){n.bindingText=o.text;break}}r(e)},!0)}]}return e.factory=function(){return function(){return new e}},e}();(module=angular.module("mcs.contols.radiolist",["mcs.controls.templates"])).directive("mcsRadioList",$RadiokboxListControlDirective.factory());var ToastrLevel,$SelectControlDirective=function(){function e(){this.templateUrl="templates/mcs.select.html",this.restrict="A",this.replace=!0,this.scope={bindingValue:"=",bindingText:"=?",bindingOptions:"=",readonly:"=?mcsReadonly"},this.controller=["$scope",function(e){var t=function(e){if(e.bindingValue=e.bindingValue||"",!e.readonly)if(e.internalOptions=[],e.internalOptions.push({value:"",text:"请选择..."}),e.bindingOptions&&e.bindingOptions.constructor==Array&&0<e.bindingOptions.length){for(var t=!1,n=0;n<e.bindingOptions.length;n++){var i=e.bindingOptions[n];e.internalOptions.push(angular.copy(i)),i.value==e.bindingValue&&(t=!0)}t||(e.bindingValue="")}else e.bindingValue&&e.internalOptions.push({value:e.bindingValue,text:e.bindingText||e.bindingValue})};e.$watch("readonly",function(){t(e)},!0),e.$watch("bindingOptions",function(){t(e)},!0),e.$watch("bindingValue",function(e,t,n){if(n.bindingText=void 0,e&&n.internalOptions&&0<n.internalOptions.length)for(var i=0;i<n.internalOptions.length;i++){var o=n.internalOptions[i];if(o.value==n.bindingValue){n.bindingText=o.text;break}}})}]}return e.factory=function(){return function(){return new e}},e}();(module=angular.module("mcs.contols.select",["mcs.controls.templates"])).directive("mcsSelect",$SelectControlDirective.factory()),function(e){e[e.Info=0]="Info",e[e.Success=1]="Success",e[e.Warning=2]="Warning",e[e.Error=3]="Error"}(ToastrLevel||(ToastrLevel={}));var TreeNodeType,$ToastrService=function(){function e(e,t,n){this.interval=10;var i=e.get("templates/mcs.toast.html");if(!i)throw"must need templates/mcs.toast.html";this.toastrScope=n.$new(),this.toastrScope.messages=[],this.toastrScope.setRemainingTimeZero=function(e){e.remainingTime=0};var o=t(angular.element(i))(this.toastrScope);angular.element(document).find("body").append(o)}return e.prototype.send=function(e,t,n,i){var o=this;if(e){n=n||ToastrLevel.Info,i=i||5e3;var r={title:t||this.getDefautTitle(n),content:e,remaining:this.getRemaining(i,i),remainingTime:i,timeOut:i,className:this.getClassName(n)};this.toastrScope.messages.push(r),this.intervalID||(this.intervalID=window.setInterval(function(){return o.innerTimerHandler()},this.interval))}},e.prototype.innerTimerHandler=function(){for(var e=this.toastrScope.messages,t=0;t<e.length;t++){var n=e[t];if(n.remainingTime-=this.interval,n.remaining=this.getRemaining(n.remainingTime,n.timeOut),n.remainingTime<=0)return e.splice(t,1),this.innerTimerHandler()}0==e.length&&(window.clearInterval(this.intervalID),this.intervalID=void 0),this.toastrScope.$apply()},e.prototype.getRemaining=function(e,t){return e<0?"0":e/t*100+"%"},e.prototype.getDefautTitle=function(e){switch(e){case ToastrLevel.Success:return"Success";case ToastrLevel.Warning:return"Warning";case ToastrLevel.Error:return"Error";default:return"Info"}},e.prototype.getClassName=function(e){switch(e){case ToastrLevel.Success:return"success";case ToastrLevel.Warning:return"warning";case ToastrLevel.Error:return"error";default:return"info"}},e.$inject=["$templateCache","$compile","$rootScope"],e}(),modMain=angular.module("mcs.contols.toastr",["mcs.controls.templates"]);modMain.service("toastrService",$ToastrService),function(e){e[e.folder=0]="folder",e[e.file=1]="file",e[e.user=2]="user"}(TreeNodeType||(TreeNodeType={}));var $TreeControlController=function(){function e(t,e,n,i,o){var r=this;if(this.$scope=t,this.$q=e,this.$templateCache=n,this.$compile=i,this.$controller=o,!t.optionsName)throw"must need options.";if(t.options=t.$parent.$eval(t.optionsName),!t.options)throw"must need options.";this.options=t.options,this.loadRootNode().then(function(e){r.renderTreeNode(t.rootContainer,t,e)})}return e.prototype.renderTreeNode=function(e,t,n){var i=angular.element(this.$templateCache.get("templates/mcs.tree.node.html")),o=t.$new();o.rootController=this,o.item=n,o.nodeContainer=i.find(".node-container"),this.$controller($TreeNodeController,{$scope:o});var r=this.$compile(i)(o);e.append(r)},e.prototype.loadRootNode=function(){var e=this.$q.defer();return this.$scope.data?e.resolve(this.convertViewModel(this.options.data,0)):this.options.data&&(this.options.data.open=null!=this.options.data.children,this.$scope.data=this.convertViewModel(this.options.data,0),e.resolve(this.$scope.data)),e.promise},e.prototype.loadChildrenTreeNode=function(n){var i=this,o=this.$q.defer();if(n.children)o.resolve(n.children);else if(this.options.adapter&&this.options.adapter.loadChildren){var e=this.options.adapter.loadChildren(n.source.id);if(this.isIPromise(e))e.then(function(e){e=e||[];var t=i.convertViewModels(e,n.level);n.children=t,n.loaded=!0,o.resolve(n.children)});else{var t=this.convertViewModels(e,n.level);n.children=t,n.loaded=!0,o.resolve(n.children)}}return o.promise},e.prototype.isIPromise=function(e){return e&&void 0!==e.then},e.prototype.convertViewModels=function(e,t){for(var n=[],i=0;i<e.length;i++){var o=e[i];n.push(this.convertViewModel(o,t))}return n},e.prototype.convertViewModel=function(e,t){var n={level:++t,open:e.open||!1,loaded:!1,type:e.type||TreeNodeType.folder,source:e};if(e.children&&e.children.constructor==Array){n.children=[],n.loaded=!0;for(var i=0;i<e.children.length;i++){var o=e.children[i];n.children.push(this.convertViewModel(o,t))}}return n},e.$inject=["$scope","$q","$templateCache","$compile","$controller"],e}(),$TreeNodeController=function(){function e(e){var t=this;(this.$scope=e).expand=function(){e.item.open=!e.item.open,e.item.loaded||e.item.type!=TreeNodeType.folder||t.internalRenderChildren(e)},e.item.open&&e.item.type==TreeNodeType.folder&&this.internalRenderChildren(e)}return e.prototype.internalRenderChildren=function(i){i.rootController.loadChildrenTreeNode(i.item).then(function(e){for(var t=0;t<e.length;t++){var n=e[t];i.rootController.renderTreeNode(i.nodeContainer,i,n)}})},e.$inject=["$scope"],e}(),$TreeControlDirective=function(){function e(){this.templateUrl="templates/mcs.tree.html",this.restrict="A",this.scope={optionsName:"@mcsTree",bindingValue:"=",readonly:"=?mcsReadonly"},this.controller=$TreeControlController,this.link=function(e,t,n,i,o){e.rootContainer=t.find(".ztree")}}return e.factory=function(){return function(){return new e}},e}();(module=angular.module("mcs.contols.tree",["mcs.controls.templates"])).directive("mcsTree",$TreeControlDirective.factory());